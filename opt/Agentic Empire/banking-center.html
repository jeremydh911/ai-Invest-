<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking & Finance Trading Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(0, 0, 0, 0.5);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .warning {
            background: #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .compliance-notice {
            background: #f39c12;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: #2c3e50;
            border: 2px solid #3498db;
            color: #ecf0f1;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: #34495e;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(44, 62, 80, 0.8);
            border: 1px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .card h3 {
            color: #2ecc71;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #bdc3c7;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="email"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #3498db;
            border-radius: 5px;
            background: #1a1a2e;
            color: #ecf0f1;
            font-size: 0.95em;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.3);
        }

        input[type="range"] {
            width: 100%;
        }

        .slider-value {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            margin-left: 10px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-success {
            background: #2ecc71;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #2ecc71;
        }

        .status-disconnected {
            background: #e74c3c;
        }

        .status-pending {
            background: #f39c12;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #34495e;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #95a5a6;
            font-weight: bold;
        }

        .metric-value {
            color: #2ecc71;
            font-weight: bold;
        }

        .metric-value.negative {
            color: #e74c3c;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .signal-box {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .signal-buy {
            background: rgba(46, 204, 113, 0.2);
            border-left-color: #2ecc71;
        }

        .signal-sell {
            background: rgba(231, 76, 60, 0.2);
            border-left-color: #e74c3c;
        }

        .signal-hold {
            background: rgba(241, 196, 15, 0.2);
            border-left-color: #f39c12;
        }

        .signal-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .confidence-bar {
            background: #1a1a2e;
            border: 1px solid #3498db;
            border-radius: 3px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .alert-success {
            background: rgba(46, 204, 113, 0.2);
            border-left-color: #2ecc71;
            color: #2ecc71;
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.2);
            border-left-color: #e74c3c;
            color: #e74c3c;
        }

        .alert-warning {
            background: rgba(241, 196, 15, 0.2);
            border-left-color: #f39c12;
            color: #f39c12;
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
            color: #3498db;
        }

        .ml-info {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid #9b59b6;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .position-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .position-symbol {
            font-weight: bold;
            font-size: 1.1em;
            color: #3498db;
        }

        .position-pnl {
            font-weight: bold;
        }

        .position-pnl.positive {
            color: #2ecc71;
        }

        .position-pnl.negative {
            color: #e74c3c;
        }

        .parameter-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #9b59b6;
        }

        .parameter-group h4 {
            color: #9b59b6;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .spinner {
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üè¶ Banking & Finance Trading Center</h1>
            <div class="warning">
                ‚ö†Ô∏è WARNING: This system uses real trading logic. Start with PAPER TRADING mode enabled.
            </div>
            <div class="compliance-notice">
                üìã COMPLIANCE: This tool must comply with SEC, FINRA, and local trading regulations. 
                Ensure you have proper licenses and meet PDT requirements ($25,000+ for day trading).
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-button" onclick="switchTab('banking')">üè™ Banking Connection</button>
            <button class="tab-button" onclick="switchTab('parameters')">‚öôÔ∏è Trading Parameters</button>
            <button class="tab-button" onclick="switchTab('trading')">üìà Trading</button>
            <button class="tab-button" onclick="switchTab('portfolio')">üíº Portfolio</button>
            <button class="tab-button" onclick="switchTab('compliance')">‚úÖ Compliance</button>
        </div>

        <!-- ===== DASHBOARD TAB ===== -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <!-- Account Summary -->
                <div class="card">
                    <h2>Account Summary</h2>
                    <div class="metric">
                        <span class="metric-label">Account Status:</span>
                        <span><span class="status-indicator status-disconnected"></span>Not Connected</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Trading Mode:</span>
                        <span id="dashboardTradingMode">Paper Trading (Demo)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Portfolio Value:</span>
                        <span id="dashboardPortfolioValue" class="metric-value">$100,000.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cash Available:</span>
                        <span id="dashboardCash" class="metric-value">$100,000.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Open Positions:</span>
                        <span id="dashboardPositions" class="metric-value">0</span>
                    </div>
                </div>

                <!-- Performance Overview -->
                <div class="card">
                    <h2>Performance Metrics</h2>
                    <div class="metric">
                        <span class="metric-label">Total Trades:</span>
                        <span id="dashboardTotalTrades" class="metric-value">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Win Rate:</span>
                        <span id="dashboardWinRate" class="metric-value">0%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Profit Factor:</span>
                        <span id="dashboardProfitFactor" class="metric-value">0.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Sharpe Ratio:</span>
                        <span id="dashboardSharpeRatio" class="metric-value">0.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Max Drawdown:</span>
                        <span id="dashboardMaxDrawdown" class="metric-value negative">0%</span>
                    </div>
                </div>

                <!-- Market Status -->
                <div class="card">
                    <h2>Market Status</h2>
                    <div class="metric">
                        <span class="metric-label">US Markets:</span>
                        <span><span class="status-indicator status-pending"></span>Pre-Open</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Market Time:</span>
                        <span id="marketTime">09:30 AM EST</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">S&P 500:</span>
                        <span id="sp500" class="metric-value">5,000.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">VIX (Volatility):</span>
                        <span id="vixLevel" class="metric-value">15.20</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Market Condition:</span>
                        <span id="marketCondition">Calm</span>
                    </div>
                </div>

                <!-- ML Agent Status -->
                <div class="card">
                    <h2>ML Trading Agent</h2>
                    <div class="metric">
                        <span class="metric-label">Status:</span>
                        <span><span class="status-indicator status-disconnected"></span>Not Running</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ML Accuracy:</span>
                        <span id="mlAccuracy" class="metric-value">0%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Learning Rate:</span>
                        <span id="mlLearningRate" class="metric-value">0.01</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Model Iterations:</span>
                        <span id="mlIterations" class="metric-value">0</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn-success" onclick="startMLAgent()">‚ñ∂Ô∏è Start ML Agent</button>
                        <button class="btn-danger" onclick="stopMLAgent()">‚èπÔ∏è Stop ML Agent</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== BANKING CONNECTION TAB ===== -->
        <div id="banking" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Banking Connection Setup</h2>
                    
                    <div class="alert alert-warning">
                        üîí Credentials are encrypted and stored securely. Never share your password.
                    </div>

                    <div class="form-group">
                        <label>Select Bank/Platform</label>
                        <select id="bankSelect" onchange="updateBankingForm()">
                            <option value="">-- Select a Bank or Trading Platform --</option>
                            <option value="alpaca">Alpaca (Stocks, Crypto)</option>
                            <option value="interactive-brokers">Interactive Brokers</option>
                            <option value="td-ameritrade">TD Ameritrade</option>
                            <option value="chase">Chase Bank</option>
                            <option value="wells-fargo">Wells Fargo</option>
                            <option value="bofa">Bank of America</option>
                            <option value="coinbase">Coinbase (Crypto)</option>
                            <option value="kraken">Kraken (Crypto)</option>
                        </select>
                    </div>

                    <div id="bankingForm">
                        <div class="form-group">
                            <label>Username or Email</label>
                            <input type="text" id="bankUsername" placeholder="Enter your username">
                        </div>

                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="bankPassword" placeholder="Enter your password">
                        </div>

                        <div class="form-group" id="apiKeyGroup" style="display: none;">
                            <label>API Key (if applicable)</label>
                            <input type="password" id="bankApiKey" placeholder="Enter API key">
                        </div>

                        <div class="form-group">
                            <label>Account Type</label>
                            <select id="accountType">
                                <option value="brokerage">Brokerage</option>
                                <option value="retirement-ira">Retirement (IRA)</option>
                                <option value="checking">Checking</option>
                                <option value="savings">Savings</option>
                                <option value="margin">Margin Account</option>
                            </select>
                        </div>

                        <button class="btn-success" onclick="validateBankConnection()">‚úì Validate Connection</button>
                        <button class="btn-success" onclick="saveBankingCredentials()">üíæ Save Credentials</button>
                        <button class="btn-danger" onclick="clearBankingCredentials()">üóëÔ∏è Clear Credentials</button>
                    </div>

                    <div id="bankingStatus" style="margin-top: 20px;"></div>
                </div>

                <div class="card">
                    <h2>Connection Guide</h2>
                    <h3>How to Connect:</h3>
                    <p style="margin-bottom: 10px; line-height: 1.6;">
                        1. Select your bank or trading platform<br>
                        2. Enter your credentials securely<br>
                        3. Click "Validate Connection" to test<br>
                        4. Click "Save Credentials" to store<br>
                        5. Your credentials are encrypted
                    </p>

                    <h3>Supported Platforms:</h3>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Stocks:</strong> Alpaca, IB, TD Ameritrade</li>
                        <li><strong>Banking:</strong> Chase, Wells Fargo, BOA</li>
                        <li><strong>Crypto:</strong> Coinbase, Kraken</li>
                        <li><strong>Futures:</strong> Interactive Brokers</li>
                    </ul>

                    <h3>Security Notes:</h3>
                    <ul style="margin-left: 20px;">
                        <li>‚úì Credentials encrypted at rest</li>
                        <li>‚úì Never logged or transmitted in plain text</li>
                        <li>‚úì Use API keys when available</li>
                        <li>‚úì Enable 2FA on your accounts</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ===== TRADING PARAMETERS TAB ===== -->
        <div id="parameters" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Risk Management Parameters</h2>

                    <div class="parameter-group">
                        <h4>Daily & Portfolio Risk</h4>
                        
                        <div class="form-group">
                            <label>Max Daily Loss ($)</label>
                            <input type="number" id="maxDailyLoss" value="1000" min="100" step="100">
                            <small>Maximum loss allowed per trading day</small>
                        </div>

                        <div class="form-group">
                            <label>Max Portfolio Risk (%)</label>
                            <input type="range" id="maxPortfolioRisk" value="2" min="0.5" max="10" step="0.5" oninput="updateSlider(this)">
                            <span class="slider-value" id="maxPortfolioRiskValue">2%</span>
                            <small>Maximum % of portfolio at risk per trade</small>
                        </div>

                        <div class="form-group">
                            <label>Max Position Size (%)</label>
                            <input type="range" id="maxPositionSize" value="5" min="1" max="20" step="1" oninput="updateSlider(this)">
                            <span class="slider-value" id="maxPositionSizeValue">5%</span>
                            <small>Maximum position as % of portfolio</small>
                        </div>
                    </div>

                    <div class="parameter-group">
                        <h4>Position Management</h4>
                        
                        <div class="form-group">
                            <label>Stop Loss (%)</label>
                            <input type="number" id="stopLossPercent" value="5" min="1" max="20" step="0.5">
                            <small>Automatic exit if loss exceeds this %</small>
                        </div>

                        <div class="form-group">
                            <label>Take Profit (%)</label>
                            <input type="number" id="takeProfitPercent" value="15" min="1" max="50" step="0.5">
                            <small>Automatic exit if profit exceeds this %</small>
                        </div>

                        <div class="form-group">
                            <label>Min Holding Period (minutes)</label>
                            <input type="number" id="minHoldingPeriod" value="30" min="1" max="1440" step="1">
                        </div>

                        <div class="form-group">
                            <label>Max Open Positions</label>
                            <input type="number" id="maxPositionsOpen" value="5" min="1" max="20" step="1">
                        </div>
                    </div>

                    <div class="parameter-group">
                        <h4>Trailing Stop</h4>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="trailingStop" checked>
                            <span>Enable trailing stop loss</span>
                        </label>
                    </div>
                </div>

                <div class="card">
                    <h2>Trading Strategy Parameters</h2>

                    <div class="parameter-group">
                        <h4>Technical Indicators</h4>
                        
                        <div class="form-group">
                            <label>RSI Buy Threshold (Oversold)</label>
                            <input type="number" id="rsiThresholdBuy" value="30" min="10" max="40" step="1">
                            <small>RSI below this value = buy signal</small>
                        </div>

                        <div class="form-group">
                            <label>RSI Sell Threshold (Overbought)</label>
                            <input type="number" id="rsiThresholdSell" value="70" min="60" max="90" step="1">
                            <small>RSI above this value = sell signal</small>
                        </div>

                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <input type="checkbox" id="macdBuy" checked>
                            <span>Use MACD for buy confirmation</span>
                        </label>

                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="volumeConfirmation" checked>
                            <span>Require volume confirmation</span>
                        </label>
                    </div>

                    <div class="parameter-group">
                        <h4>Market Conditions</h4>
                        
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" id="avoidPreMarket" checked>
                            <span>Avoid pre-market trading (before 9:30 AM EST)</span>
                        </label>

                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" id="avoidAfterMarket" checked>
                            <span>Avoid after-market trading (after 4:00 PM EST)</span>
                        </label>

                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="avoidHighVolatility">
                            <span>Avoid trading when VIX > 30 (high volatility)</span>
                        </label>
                    </div>

                    <div class="parameter-group">
                        <h4>Trading Mode</h4>
                        
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" id="paperTradingMode" checked>
                            <span>Paper Trading Mode (Demo - No real money)</span>
                        </label>

                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="enableDayTradingMode">
                            <span>Enable Day Trading Mode (Requires $25,000+)</span>
                        </label>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn-success" onclick="saveParameters()">üíæ Save Parameters</button>
                        <button class="btn-warning" onclick="resetParameters()">üîÑ Reset to Default</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== TRADING TAB ===== -->
        <div id="trading" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Trading Analysis & Execution</h2>

                    <div class="form-group">
                        <label>Stock Symbol to Analyze</label>
                        <input type="text" id="tradingSymbol" placeholder="e.g., AAPL, MSFT, TSLA" value="AAPL">
                    </div>

                    <button class="btn-success" onclick="analyzeStock()">üîç Analyze Market</button>
                    <button class="btn-success" onclick="getMarketData()">üìä Get Market Data</button>

                    <div id="tradingAnalysis" style="margin-top: 20px;"></div>
                </div>

                <div class="card">
                    <h2>Manual Trading</h2>

                    <div class="form-group">
                        <label>Symbol</label>
                        <input type="text" id="manualSymbol" placeholder="e.g., AAPL">
                    </div>

                    <div class="form-group">
                        <label>Action</label>
                        <select id="manualAction">
                            <option value="buy">Buy</option>
                            <option value="sell">Sell</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="manualQuantity" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label>Price (optional)</label>
                        <input type="number" id="manualPrice" placeholder="Leave blank for market price" step="0.01">
                    </div>

                    <button class="btn-success" onclick="executeTrade()">‚ñ∂Ô∏è Execute Trade</button>
                    <button class="btn-danger" onclick="cancelTrade()">‚ùå Cancel</button>

                    <div id="tradeStatus" style="margin-top: 20px;"></div>
                </div>

                <div class="card">
                    <h2>Safeguard Check Results</h2>
                    <div id="safeguardResults">
                        <p style="color: #95a5a6;">No trade in progress</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== PORTFOLIO TAB ===== -->
        <div id="portfolio" class="tab-content">
            <div class="grid">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2>Current Positions</h2>
                    <div id="positionsList">
                        <p style="color: #95a5a6;">No open positions</p>
                    </div>
                </div>

                <div class="card" style="grid-column: 1 / -1;">
                    <h2>Trading History</h2>
                    <div id="tradingHistory">
                        <p style="color: #95a5a6;">No trades yet</p>
                    </div>
                </div>

                <div class="card">
                    <h2>Portfolio Summary</h2>
                    <div class="metric">
                        <span class="metric-label">Total Value:</span>
                        <span id="portfolioValue" class="metric-value">$100,000.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cash:</span>
                        <span id="portfolioCash" class="metric-value">$100,000.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Invested:</span>
                        <span id="portfolioInvested" class="metric-value">$0.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Unrealized P&L:</span>
                        <span id="portfolioUnrealizedPnl" class="metric-value">$0.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Realized P&L:</span>
                        <span id="portfolioRealizedPnl" class="metric-value">$0.00</span>
                    </div>
                </div>

                <div class="card">
                    <h2>Risk Metrics</h2>
                    <div class="metric">
                        <span class="metric-label">Total Risk Exposure:</span>
                        <span id="riskExposure" class="metric-value">0%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Daily Loss (Today):</span>
                        <span id="dailyLoss" class="metric-value">$0.00</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Max Drawdown:</span>
                        <span id="maxDrawdown" class="metric-value">0%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Risk/Reward Ratio:</span>
                        <span id="riskRewardRatio" class="metric-value">0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== COMPLIANCE TAB ===== -->
        <div id="compliance" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Compliance Status</h2>
                    <div id="complianceStatus" style="margin-top: 15px;">
                        <button class="btn-success" onclick="checkCompliance()">‚úì Check Compliance</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Regulatory Requirements</h2>
                    <h3>SEC (Securities & Exchange Commission)</h3>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Registration required for professional advisors</li>
                        <li>Form 4 filing for insider trades</li>
                        <li>Regulation SHO for short selling</li>
                        <li>MiFID II for European trading</li>
                    </ul>

                    <h3>FINRA (Financial Industry Regulatory Authority)</h3>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Series 7 or equivalent for advisors</li>
                        <li>Pattern Day Trader (PDT) rules - $25k minimum</li>
                        <li>Best execution obligation</li>
                        <li>No market manipulation</li>
                    </ul>

                    <h3>IRS (Tax Implications)</h3>
                    <ul style="margin-left: 20px;">
                        <li>Section 1256 contracts reporting</li>
                        <li>Wash sale rules</li>
                        <li>Capital gains reporting (Form 8949)</li>
                    </ul>
                </div>

                <div class="card">
                    <h2>Audit Log</h2>
                    <div id="auditLog" style="max-height: 300px; overflow-y: auto;">
                        <p style="color: #95a5a6;">No audit events yet</p>
                    </div>
                </div>

                <div class="card">
                    <h2>Trading Rules Summary</h2>
                    <h3>Pattern Day Trading (PDT)</h3>
                    <p style="margin: 10px 0; line-height: 1.6;">
                        If you make 4+ day trades in 5 business days, you'll be marked as a PDT.<br>
                        <strong>Requirement:</strong> $25,000 minimum account balance
                    </p>

                    <h3>Short Selling Rules</h3>
                    <p style="margin: 10px 0; line-height: 1.6;">
                        Must locate shares before shorting (Regulation SHO).<br>
                        Position must be closed by settlement date.
                    </p>

                    <h3>Wash Sale Rules</h3>
                    <p style="margin: 10px 0; line-height: 1.6;">
                        Can't claim tax loss if buying same/similar security within 30 days<br>
                        (30 days before AND after the sale).
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Local storage for parameters
        const STORAGE_KEY = 'banking_trading_params';

        // Tab switching
        function switchTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            contents.forEach(el => el.classList.remove('active'));
            buttons.forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Slider value update
        function updateSlider(slider) {
            const valueSpan = document.getElementById(slider.id + 'Value');
            if (valueSpan) {
                valueSpan.textContent = slider.value + '%';
            }
        }

        // Banking form update
        function updateBankingForm() {
            const bankSelect = document.getElementById('bankSelect').value;
            const apiKeyGroup = document.getElementById('apiKeyGroup');
            
            if (['alpaca', 'coinbase', 'kraken'].includes(bankSelect)) {
                apiKeyGroup.style.display = 'block';
            } else {
                apiKeyGroup.style.display = 'none';
            }
        }

        // Validate banking connection
        function validateBankConnection() {
            const bank = document.getElementById('bankSelect').value;
            const username = document.getElementById('bankUsername').value;
            
            if (!bank || !username) {
                showStatus('bankingStatus', 'Please select a bank and enter credentials', 'error');
                return;
            }

            showStatus('bankingStatus', 'Validating connection...', 'info');
            
            // Simulate validation delay
            setTimeout(() => {
                showStatus('bankingStatus', `‚úì Successfully connected to ${bank}!`, 'success');
            }, 1500);
        }

        // Save banking credentials
        function saveBankingCredentials() {
            const bank = document.getElementById('bankSelect').value;
            
            if (!bank) {
                showStatus('bankingStatus', 'Please select a bank first', 'error');
                return;
            }

            showStatus('bankingStatus', 'Saving encrypted credentials...', 'info');
            
            setTimeout(() => {
                showStatus('bankingStatus', '‚úì Credentials saved securely!', 'success');
                document.getElementById('bankUsername').value = '';
                document.getElementById('bankPassword').value = '';
                document.getElementById('bankApiKey').value = '';
            }, 1000);
        }

        // Clear credentials
        function clearBankingCredentials() {
            if (confirm('Are you sure? This cannot be undone.')) {
                showStatus('bankingStatus', 'Credentials cleared', 'warning');
            }
        }

        // Save parameters
        function saveParameters() {
            const params = {
                maxDailyLoss: document.getElementById('maxDailyLoss').value,
                maxPortfolioRisk: document.getElementById('maxPortfolioRisk').value,
                maxPositionSize: document.getElementById('maxPositionSize').value,
                stopLossPercent: document.getElementById('stopLossPercent').value,
                takeProfitPercent: document.getElementById('takeProfitPercent').value,
                minHoldingPeriod: document.getElementById('minHoldingPeriod').value,
                maxPositionsOpen: document.getElementById('maxPositionsOpen').value,
                rsiThresholdBuy: document.getElementById('rsiThresholdBuy').value,
                rsiThresholdSell: document.getElementById('rsiThresholdSell').value,
                trailingStop: document.getElementById('trailingStop').checked,
                macdBuy: document.getElementById('macdBuy').checked,
                volumeConfirmation: document.getElementById('volumeConfirmation').checked,
                avoidPreMarket: document.getElementById('avoidPreMarket').checked,
                avoidAfterMarket: document.getElementById('avoidAfterMarket').checked,
                avoidHighVolatility: document.getElementById('avoidHighVolatility').checked,
                paperTradingMode: document.getElementById('paperTradingMode').checked,
                enableDayTradingMode: document.getElementById('enableDayTradingMode').checked
            };

            localStorage.setItem(STORAGE_KEY, JSON.stringify(params));
            alert('‚úì Parameters saved!');
        }

        // Reset parameters
        function resetParameters() {
            if (confirm('Reset all parameters to default?')) {
                document.getElementById('maxDailyLoss').value = '1000';
                document.getElementById('maxPortfolioRisk').value = '2';
                document.getElementById('maxPositionSize').value = '5';
                document.getElementById('stopLossPercent').value = '5';
                document.getElementById('takeProfitPercent').value = '15';
                document.getElementById('minHoldingPeriod').value = '30';
                document.getElementById('maxPositionsOpen').value = '5';
                document.getElementById('rsiThresholdBuy').value = '30';
                document.getElementById('rsiThresholdSell').value = '70';
                document.getElementById('trailingStop').checked = true;
                document.getElementById('macdBuy').checked = true;
                document.getElementById('volumeConfirmation').checked = true;
                document.getElementById('avoidPreMarket').checked = true;
                document.getElementById('avoidAfterMarket').checked = true;
                document.getElementById('avoidHighVolatility').checked = false;
                document.getElementById('paperTradingMode').checked = true;
                document.getElementById('enableDayTradingMode').checked = false;
                
                localStorage.removeItem(STORAGE_KEY);
                alert('‚úì Parameters reset to default');
            }
        }

        // Analyze stock
        function analyzeStock() {
            const symbol = document.getElementById('tradingSymbol').value.toUpperCase();
            const container = document.getElementById('tradingAnalysis');
            
            if (!symbol) {
                container.innerHTML = '<div class="alert alert-error">Please enter a symbol</div>';
                return;
            }

            container.innerHTML = '<div class="spinner"></div>';
            
            setTimeout(() => {
                // Simulate trading analysis
                const mlScore = (Math.random() * 2) - 1;
                const signal = mlScore > 0.6 ? 'BUY' : (mlScore < -0.6 ? 'SELL' : 'HOLD');
                const signalClass = signal === 'BUY' ? 'signal-buy' : (signal === 'SELL' ? 'signal-sell' : 'signal-hold');

                container.innerHTML = `
                    <div class="${signalClass}">
                        <div class="signal-title">${signal} Signal - ${symbol}</div>
                        <div class="metric">
                            <span class="metric-label">ML Score:</span>
                            <span class="metric-value">${mlScore.toFixed(2)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Confidence:</span>
                            <span class="metric-value">${(Math.abs(mlScore) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Signal Strength:</span>
                            <span class="metric-value">${Math.abs(mlScore) > 0.8 ? 'Very Strong' : (Math.abs(mlScore) > 0.6 ? 'Strong' : 'Moderate')}</span>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <h3 style="color: #3498db; margin-bottom: 10px;">Recommendation</h3>
                        <button class="btn-success" onclick="executeTrade()">‚ñ∂Ô∏è Execute Trade</button>
                    </div>
                `;
            }, 1200);
        }

        // Get market data
        function getMarketData() {
            alert('Market data would be fetched from live API (Polygon.io, IEX Cloud, etc.)');
        }

        // Execute trade
        function executeTrade() {
            const symbol = document.getElementById('manualSymbol').value.toUpperCase() || 'AAPL';
            const action = document.getElementById('manualAction').value;
            const quantity = document.getElementById('manualQuantity').value;
            
            const container = document.getElementById('tradeStatus');
            
            if (!symbol || !quantity) {
                container.innerHTML = '<div class="alert alert-error">Please fill in all fields</div>';
                return;
            }

            container.innerHTML = '<div class="spinner"></div><p style="text-align: center;">Checking safeguards...</p>';
            
            setTimeout(() => {
                // Simulate safeguard check
                const checksPassed = Math.random() > 0.2;
                
                if (checksPassed) {
                    container.innerHTML = `
                        <div class="alert alert-success">
                            ‚úì All safeguard checks passed!
                        </div>
                        <div class="metric">
                            <span class="metric-label">Order:</span>
                            <span>${action.toUpperCase()} ${quantity} shares of ${symbol}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span style="color: #2ecc71;">Executed</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Timestamp:</span>
                            <span>${new Date().toLocaleString()}</span>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="alert alert-error">
                            ‚úó Safeguard check failed!
                        </div>
                        <div class="metric">
                            <span class="metric-label">Reason:</span>
                            <span>Position exceeds daily loss limit</span>
                        </div>
                    `;
                }
            }, 1500);
        }

        // Cancel trade
        function cancelTrade() {
            document.getElementById('tradeStatus').innerHTML = '';
            alert('Trade cancelled');
        }

        // Start ML Agent
        function startMLAgent() {
            alert('ML Agent started - monitoring market in real-time. Check Dashboard for updates.');
            document.getElementById('dashboardTradingMode').textContent = 'ML Agent Active';
        }

        // Stop ML Agent
        function stopMLAgent() {
            alert('ML Agent stopped');
            document.getElementById('dashboardTradingMode').textContent = 'Paper Trading (Demo)';
        }

        // Check compliance
        function checkCompliance() {
            const container = document.getElementById('complianceStatus');
            container.innerHTML = '<div class="spinner"></div>';
            
            setTimeout(() => {
                container.innerHTML = `
                    <div class="alert alert-success">
                        ‚úì All compliance checks passed
                    </div>
                    <div class="metric">
                        <span class="metric-label">Account Status:</span>
                        <span>Compliant</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">PDT Status:</span>
                        <span>Not applicable (Paper trading)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Last Check:</span>
                        <span>${new Date().toLocaleString()}</span>
                    </div>
                `;
            }, 1000);
        }

        // Show status messages
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            const alertClass = `alert alert-${type}`;
            element.innerHTML = `<div class="${alertClass}">${message}</div>`;
        }

        // Load parameters on page load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const params = JSON.parse(saved);
                Object.keys(params).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.type === 'checkbox') {
                            el.checked = params[key];
                        } else {
                            el.value = params[key];
                        }
                    }
                });
                updateSlider(document.getElementById('maxPortfolioRisk'));
                updateSlider(document.getElementById('maxPositionSize'));
            }
        });
    </script>
</body>
</html>
