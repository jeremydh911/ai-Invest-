<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Personas - Agentic Empire</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .personas-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .form-section {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
    }
    
    .form-section h2 {
      color: #667eea;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #667eea;
    }
    
    .personas-section {
      grid-column: 1 / -1;
    }
    
    .personas-section h2 {
      color: #667eea;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #667eea;
    }
    
    .personas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .persona-item {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }
    
    .persona-item:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }
    
    .persona-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .persona-icon {
      font-size: 2rem;
    }
    
    .persona-name {
      color: #667eea;
      font-weight: 600;
    }
    
    .persona-meta {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.5rem;
    }
    
    .message {
      padding: 1rem;
      border-radius: 6px;
      margin: 1rem 0;
      border-left: 4px solid;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border-color: #dc3545;
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border-color: #28a745;
    }
    
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 3rem;
      color: #999;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      opacity: 0.5;
      margin-bottom: 1rem;
    }
    
    @media (max-width: 1024px) {
      .personas-wrapper {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>üë§ Manage Personas</h1>
    <div class="navbar-menu">
      <a href="/dashboard.html">Dashboard</a>
      <button onclick="logout()">Logout</button>
    </div>
  </div>
  
  <div class="container">
    <div class="personas-wrapper">
      <div class="form-section">
        <h2>Create New Persona</h2>
        <form id="personaForm">
          <div class="form-group">
            <label for="name">Persona Name</label>
            <input type="text" id="name" placeholder="e.g., Technical Assistant" required>
          </div>
          
          <div class="form-group">
            <label for="slug">Slug (URL-friendly name)</label>
            <input type="text" id="slug" placeholder="e.g., technical-assistant" required>
          </div>
          
          <div class="form-group">
            <label for="model">AI Model</label>
            <input type="text" id="model" placeholder="e.g., gpt-4" value="gpt-4" required>
          </div>
          
          <div class="form-group">
            <label for="voice">Voice</label>
            <input type="text" id="voice" placeholder="e.g., nova" value="nova">
          </div>
          
          <div class="form-group">
            <label for="system_prompt">System Prompt</label>
            <textarea id="system_prompt" placeholder="Define the persona's behavior, personality, and expertise. Be specific about how it should respond..." required></textarea>
          </div>
          
          <button type="submit" class="btn btn-primary btn-block" id="createBtn">Create Persona</button>
        </form>
        <div id="message"></div>
      </div>
      
      <div class="form-section">
        <h2>Quick Templates</h2>
        <div style="display: grid; gap: 1rem;">
          <button class="btn btn-ghost btn-block" onclick="applyTemplate('assistant')" style="text-align: left;">
            <div style="font-weight: 600;">üìö General Assistant</div>
            <div style="font-size: 0.85rem;">Helpful AI for general queries</div>
          </button>
          <button class="btn btn-ghost btn-block" onclick="applyTemplate('developer')" style="text-align: left;">
            <div style="font-weight: 600;">üë®‚Äçüíª Code Developer</div>
            <div style="font-size: 0.85rem;">Expert in programming and debugging</div>
          </button>
          <button class="btn btn-ghost btn-block" onclick="applyTemplate('writer')" style="text-align: left;">
            <div style="font-weight: 600;">‚úçÔ∏è Creative Writer</div>
            <div style="font-size: 0.85rem;">Specializes in creative writing</div>
          </button>
          <button class="btn btn-ghost btn-block" onclick="applyTemplate('analyst')" style="text-align: left;">
            <div style="font-weight: 600;">üìä Data Analyst</div>
            <div style="font-size: 0.85rem;">Expert in data analysis and insights</div>
          </button>
        </div>
      </div>
    </div>
    
    <div class="personas-section">
      <h2>Existing Personas</h2>
      <div class="personas-grid" id="personasList">
        <div class="empty-state">
          <div class="empty-state-icon">üë§</div>
          <p>No personas yet. Create one to get started!</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/login.html';
    }
    
    const templates = {
      assistant: {
        name: 'General Assistant',
        slug: 'general-assistant',
        model: 'gpt-4',
        voice: 'nova',
        system_prompt: 'You are a helpful, friendly, and knowledgeable AI assistant. Your goal is to provide clear, concise, and accurate answers to user questions. You adapt your communication style to match the user\'s needs and always maintain a professional yet approachable tone.'
      },
      developer: {
        name: 'Code Developer',
        slug: 'code-developer',
        model: 'gpt-4',
        voice: 'nova',
        system_prompt: 'You are an expert software developer with deep knowledge of multiple programming languages and frameworks. You provide code solutions, explain concepts clearly, and help debug issues. You follow best practices and write clean, efficient code. You\'re patient with beginners but also respect advanced developers\' expertise.'
      },
      writer: {
        name: 'Creative Writer',
        slug: 'creative-writer',
        model: 'gpt-4',
        voice: 'nova',
        system_prompt: 'You are a talented creative writer with expertise in storytelling, character development, and world-building. You help users craft engaging narratives, develop compelling characters, and polish their prose. You provide constructive feedback and inspire creativity while respecting the user\'s unique voice.'
      },
      analyst: {
        name: 'Data Analyst',
        slug: 'data-analyst',
        model: 'gpt-4',
        voice: 'nova',
        system_prompt: 'You are an expert data analyst with strong skills in statistical analysis, data visualization, and insights generation. You help users interpret data, identify trends, and draw meaningful conclusions. You explain complex concepts in accessible language and provide actionable recommendations.'
      }
    };
    
    async function loadPersonas() {
      try {
        const res = await fetch('/api/personas', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        if (!res.ok) throw new Error('Failed to load personas');
        const personas = await res.json();
        const list = document.getElementById('personasList');
        
        if (personas.length === 0) {
          list.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><div class="empty-state-icon">üë§</div><p>No personas yet. Create one to get started!</p></div>';
          return;
        }
        
        list.innerHTML = personas.map(p => `
          <div class="persona-item">
            <div class="persona-header">
              <div class="persona-icon">üë§</div>
              <div class="persona-name">${p.name}</div>
            </div>
            <div class="persona-meta"><strong>Slug:</strong> ${p.slug}</div>
            <div class="persona-meta"><strong>Model:</strong> ${p.model}</div>
          </div>
        `).join('');
      } catch (err) {
        showMessage('Error loading personas: ' + err.message, 'error');
      }
    }
    
    function applyTemplate(templateKey) {
      const template = templates[templateKey];
      if (template) {
        document.getElementById('name').value = template.name;
        document.getElementById('slug').value = template.slug;
        document.getElementById('model').value = template.model;
        document.getElementById('voice').value = template.voice;
        document.getElementById('system_prompt').value = template.system_prompt;
        document.getElementById('name').focus();
      }
    }
    
    function showMessage(msg, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.className = 'message ' + type;
      messageDiv.textContent = msg;
      messageDiv.style.display = 'block';
      if (type === 'success') setTimeout(() => messageDiv.style.display = 'none', 3000);
    }
    
    document.getElementById('personaForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const slug = document.getElementById('slug').value;
      const model = document.getElementById('model').value;
      const voice = document.getElementById('voice').value;
      const system_prompt = document.getElementById('system_prompt').value;
      const createBtn = document.getElementById('createBtn');
      
      createBtn.disabled = true;
      try {
        const res = await fetch('/api/personas', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ name, slug, model, voice, system_prompt })
        });
        
        if (!res.ok) throw new Error('Failed to create persona');
        
        showMessage('‚úì Persona created successfully!', 'success');
        document.getElementById('personaForm').reset();
        loadPersonas();
      } catch (err) {
        showMessage('‚úó ' + err.message, 'error');
      } finally {
        createBtn.disabled = false;
      }
    });
    
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login.html';
    }
    
    loadPersonas();
  </script>
</body>
</html>