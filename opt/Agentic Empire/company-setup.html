<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Company Setup - Agentic Empire</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; min-height: 100vh; padding: 2rem; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 3rem; }
    h1 { font-size: 2rem; color: #333; margin-bottom: 0.5rem; }
    .subtitle { color: #666; font-size: 1rem; }
    .setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    .setup-card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .setup-card h2 { font-size: 1.5rem; margin-bottom: 1rem; color: #333; }
    .setup-card p { color: #666; margin-bottom: 1.5rem; line-height: 1.6; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.5rem; color: #555; font-weight: 500; }
    input, select, textarea { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; font-family: inherit; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
    button { padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #5568d3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .button-group { display: flex; gap: 1rem; margin-top: 1.5rem; }
    .alert { padding: 1rem; border-radius: 4px; margin-bottom: 1rem; }
    .alert-info { background: #e7f3ff; border-left: 4px solid #0066cc; color: #0066cc; }
    .alert-error { background: #fff3cd; border-left: 4px solid #dc3545; color: #dc3545; }
    .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #28a745; }
    .access-warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-top: 15px;
      border-radius: 5px;
            color: #856404;
            font-size: 13px;
        }

        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .tab-button {
            padding: 12px 24px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tab-button:hover {
            background: #e0e0e0;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #333;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 13px;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="tel"],
        select,
        textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="date"]:focus,
        input[type="tel"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .sensitive-field {
            background: #f9f3f0;
            border-left: 3px solid #e74c3c;
        }

        .sensitive-label::after {
            content: " üîí";
            color: #e74c3c;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .success-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .error-message {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .card p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }

        .org-chart-preview {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
        }

        .compliance-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .compliance-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }

        .compliance-card.compliant {
            border-left-color: #28a745;
        }

        .compliance-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .compliance-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 10px;
        }

        .badge-compliant {
            background: #d4edda;
            color: #155724;
        }

        .badge-non-compliant {
            background: #f8d7da;
            color: #721c24;
        }

        .audit-log {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .audit-entry {
            background: white;
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            border-radius: 3px;
            font-size: 12px;
        }

        .audit-entry .timestamp {
            color: #999;
            font-size: 11px;
        }

        .audit-entry .action {
            color: #667eea;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .grid-2x2 {
                grid-template-columns: 1fr;
            }

            .tabs-container {
                flex-wrap: wrap;
            }

            .tab-button {
                flex: 1;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè¢ Company Setup - Master Configuration</h1>
            <p>Enterprise-grade company data management with encryption and compliance standards</p>
            <div class="access-warning">
                ‚ö†Ô∏è <strong>ADMIN/POWER USER ONLY:</strong> This page contains sensitive company information including banking details, EIN, and organizational structure. Access is restricted and all changes are logged.
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab-button active" onclick="switchTab('company-info')">Company Info</button>
            <button class="tab-button" onclick="switchTab('banking')">Banking & Finance</button>
            <button class="tab-button" onclick="switchTab('org-chart')">Organizational Chart</button>
            <button class="tab-button" onclick="switchTab('compliance')">Compliance Status</button>
            <button class="tab-button" onclick="switchTab('audit')">Audit Log</button>
        </div>

        <!-- SUCCESS/ERROR MESSAGES -->
        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <!-- TAB 1: COMPANY INFORMATION -->
        <div class="tab-content active" id="company-info">
            <form id="companyInfoForm">
                <div class="form-section">
                    <h2>Company Information</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName">Company Name</label>
                            <input type="text" id="companyName" name="companyName" required placeholder="AgenticEmpire Inc.">
                        </div>
                        <div class="form-group">
                            <label for="companyLegal">Legal Business Name</label>
                            <input type="text" id="companyLegal" name="companyLegal" placeholder="AgenticEmpire Corporation">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="ein" class="sensitive-label">EIN (Employer Identification Number)</label>
                            <input type="text" id="ein" name="ein" class="sensitive-field" required placeholder="12-3456789" pattern="\d{2}-\d{7}">
                            <small>Format: XX-XXXXXXX</small>
                        </div>
                        <div class="form-group">
                            <label for="industry">Industry</label>
                            <select id="industry" name="industry" required>
                                <option value="">Select Industry</option>
                                <option value="Technology">Technology/SaaS</option>
                                <option value="Financial Services">Financial Services</option>
                                <option value="Real Estate">Real Estate/PropTech</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Logistics">Logistics/Supply Chain</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="Retail">Retail</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Education">Education</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="incorporationDate">Date of Incorporation</label>
                            <input type="date" id="incorporationDate" name="incorporationDate" required>
                        </div>
                        <div class="form-group">
                            <label for="businessType">Business Type</label>
                            <select id="businessType" name="businessType">
                                <option value="C-Corporation">C-Corporation</option>
                                <option value="S-Corporation">S-Corporation</option>
                                <option value="LLC">LLC</option>
                                <option value="Partnership">Partnership</option>
                                <option value="Sole Proprietorship">Sole Proprietorship</option>
                                <option value="Non-Profit">Non-Profit</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Headquarters Address</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="street">Street Address</label>
                            <input type="text" id="street" name="street" required placeholder="123 Main Street">
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="state">State/Province</label>
                            <input type="text" id="state" name="state" required>
                        </div>
                        <div class="form-group">
                            <label for="zipcode">ZIP/Postal Code</label>
                            <input type="text" id="zipcode" name="zipcode" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="country">Country</label>
                            <input type="text" id="country" name="country" value="United States" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Contact Information</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainPhone">Main Phone Number</label>
                            <input type="tel" id="mainPhone" name="mainPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label for="mainEmail">Main Email Address</label>
                            <input type="email" id="mainEmail" name="mainEmail" placeholder="contact@company.com">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="website">Website</label>
                            <input type="text" id="website" name="website" placeholder="https://www.company.com">
                        </div>
                        <div class="form-group">
                            <label for="taxPhone">Tax Department Phone</label>
                            <input type="tel" id="taxPhone" name="taxPhone">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-primary">üíæ Save Company Information</button>
                    <button type="button" class="btn-secondary" onclick="resetForm('companyInfoForm')">Reset</button>
                </div>
            </form>
        </div>

        <!-- TAB 2: BANKING & FINANCE -->
        <div class="tab-content" id="banking">
            <form id="bankingForm">
                <div class="form-section">
                    <h2>Primary Banking Information üîí</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankName" class="sensitive-label">Bank Name</label>
                            <input type="text" id="bankName" name="bankName" class="sensitive-field" placeholder="Chase Bank">
                        </div>
                        <div class="form-group">
                            <label for="bankRoutingNumber" class="sensitive-label">Routing Number</label>
                            <input type="text" id="bankRoutingNumber" name="bankRoutingNumber" class="sensitive-field" placeholder="XXXXXXXXX" pattern="\d{9}">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankAccountNumber" class="sensitive-label">Account Number</label>
                            <input type="text" id="bankAccountNumber" name="bankAccountNumber" class="sensitive-field" placeholder="Account Number (encrypted)">
                        </div>
                        <div class="form-group">
                            <label for="accountType">Account Type</label>
                            <select id="accountType" name="accountType">
                                <option value="">Select Account Type</option>
                                <option value="Checking">Checking</option>
                                <option value="Savings">Savings</option>
                                <option value="Money Market">Money Market</option>
                                <option value="Credit Line">Credit Line</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankAccountHolder" class="sensitive-label">Account Holder Name</label>
                            <input type="text" id="bankAccountHolder" name="bankAccountHolder" class="sensitive-field">
                        </div>
                        <div class="form-group">
                            <label for="bankPhone" class="sensitive-label">Bank Contact Phone</label>
                            <input type="tel" id="bankPhone" name="bankPhone" class="sensitive-field">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Banking Compliance</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="glbaCompliance">
                                <input type="checkbox" id="glbaCompliance" name="glbaCompliance">
                                GLBA (Gramm-Leach-Bliley Act) Compliance Verified
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="soxCompliance">
                                <input type="checkbox" id="soxCompliance" name="soxCompliance">
                                SOX (Sarbanes-Oxley) Compliance Verified
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankingComplianceDate">Last Compliance Verification</label>
                            <input type="date" id="bankingComplianceDate" name="bankingComplianceDate">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Payroll & Tax Information üîí</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payrollProvider" class="sensitive-label">Payroll Provider</label>
                            <input type="text" id="payrollProvider" name="payrollProvider" class="sensitive-field" placeholder="ADP, Paychex, etc.">
                        </div>
                        <div class="form-group">
                            <label for="payrollAccountId" class="sensitive-label">Payroll Account ID</label>
                            <input type="text" id="payrollAccountId" name="payrollAccountId" class="sensitive-field">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taxFilingFrequency">Tax Filing Frequency</label>
                            <select id="taxFilingFrequency" name="taxFilingFrequency">
                                <option value="">Select Frequency</option>
                                <option value="Monthly">Monthly</option>
                                <option value="Quarterly">Quarterly</option>
                                <option value="Semi-Annual">Semi-Annual</option>
                                <option value="Annual">Annual</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fiscalYearEnd">Fiscal Year End Date</label>
                            <input type="date" id="fiscalYearEnd" name="fiscalYearEnd">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-primary">üíæ Save Banking Information</button>
                    <button type="button" class="btn-secondary" onclick="resetForm('bankingForm')">Reset</button>
                </div>
            </form>
        </div>

        <!-- TAB 3: ORGANIZATIONAL CHART -->
        <div class="tab-content" id="org-chart">
            <div class="form-section">
                <h2>Organizational Structure Template</h2>
                <p style="color: #666; margin-bottom: 15px;">Select an industry template to configure your organizational hierarchy for scaling to 150+ employees.</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="templateIndustry">Select Industry Template</label>
                        <select id="templateIndustry" onchange="loadOrgChartTemplate(this.value)">
                            <option value="">-- Choose an Industry --</option>
                            <option value="Technology">Technology/SaaS</option>
                            <option value="Financial Services">Financial Services</option>
                            <option value="Real Estate">Real Estate/PropTech</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Logistics">Logistics/Supply Chain</option>
                            <option value="Professional Services">Professional Services</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="targetHeadcount">Target Headcount</label>
                        <input type="number" id="targetHeadcount" name="targetHeadcount" min="10" max="500" value="150" placeholder="150">
                    </div>
                </div>
            </div>

            <div id="orgChartContainer" style="display: none;">
                <div class="form-section">
                    <h2>Template Preview</h2>
                    <div class="org-chart-preview" id="orgChartPreview">
                        <!-- Chart loads here -->
                    </div>
                </div>

                <div class="form-section">
                    <h2>Hiring Recommendations</h2>
                    <div id="hiringRecommendations" class="grid-2x2">
                        <!-- Recommendations load here -->
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="saveOrgChart()">üíæ Save Organizational Chart</button>
                    <button type="button" class="btn-secondary" onclick="exportOrgChart()">‚¨áÔ∏è Export as PDF</button>
                </div>
            </div>
        </div>

        <!-- TAB 4: COMPLIANCE STATUS -->
        <div class="tab-content" id="compliance">
            <div class="form-section">
                <h2>Compliance Status Overview</h2>
                <p style="color: #666; margin-bottom: 20px;">Real-time compliance verification across all regulatory frameworks</p>

                <div class="compliance-status">
                    <div class="compliance-card">
                        <h4>DLP (Data Loss Prevention)</h4>
                        <p>Automatic detection and blocking of sensitive data in communications.</p>
                        <span class="compliance-badge badge-compliant">‚úì Implemented</span>
                    </div>

                    <div class="compliance-card">
                        <h4>GLBA Compliance</h4>
                        <p>Financial privacy and security safeguards for customer information.</p>
                        <div id="glbaStatus">Checking...</div>
                    </div>

                    <div class="compliance-card">
                        <h4>SOX Compliance</h4>
                        <p>Internal controls and financial reporting accuracy for public companies.</p>
                        <div id="soxStatus">Checking...</div>
                    </div>

                    <div class="compliance-card">
                        <h4>HIPAA Compliance</h4>
                        <p>Protected Health Information (PHI) privacy and security (if applicable).</p>
                        <span class="compliance-badge badge-non-compliant">Not Applicable</span>
                    </div>

                    <div class="compliance-card">
                        <h4>Fair Housing</h4>
                        <p>Non-discrimination and equal access in real estate (if applicable).</p>
                        <span class="compliance-badge badge-non-compliant">Not Applicable</span>
                    </div>

                    <div class="compliance-card">
                        <h4>Data Security</h4>
                        <p>AES-256 encryption, access controls, and audit logging enabled.</p>
                        <span class="compliance-badge badge-compliant">‚úì Enabled</span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>Compliance Verification</h2>
                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="verifyCompliance()">üîç Run Compliance Check</button>
                    <button type="button" class="btn-secondary" onclick="generateComplianceReport()">üìÑ Generate Report</button>
                </div>
            </div>
        </div>

        <!-- TAB 5: AUDIT LOG -->
        <div class="tab-content" id="audit">
            <div class="form-section">
                <h2>Master Configuration Audit Trail</h2>
                <p style="color: #666; margin-bottom: 20px;">All changes to company configuration are logged for compliance and security verification.</p>

                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="loadAuditLog()">üìã Load Audit Log</button>
                    <button type="button" class="btn-secondary" onclick="downloadAuditLog()">‚¨áÔ∏è Download as CSV</button>
                </div>
            </div>

            <div class="audit-log" id="auditLogContainer">
                <div class="loading">
                    <p>Click "Load Audit Log" to view activity history</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // TAB SWITCHING
        // ============================================================================

        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remove active class from buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // ============================================================================
        // FORM HANDLING
        // ============================================================================

        document.getElementById('companyInfoForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch('/api/company-setup/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showSuccess('Company information saved successfully!');
                    localStorage.setItem('companyId', (await response.json()).id);
                } else {
                    showError('Failed to save company information');
                }
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        });

        document.getElementById('bankingForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const companyId = localStorage.getItem('companyId');
            if (!companyId) {
                showError('Please save company information first');
                return;
            }

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch(`/api/company-setup/${companyId}/update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showSuccess('Banking information saved securely!');
                } else {
                    showError('Failed to save banking information');
                }
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        });

        // ============================================================================
        // ORGANIZATIONAL CHART
        // ============================================================================

        function loadOrgChartTemplate(industry) {
            if (!industry) {
                document.getElementById('orgChartContainer').style.display = 'none';
                return;
            }

            const templates = {
                'Technology': `
                     CEO
                    ‚îú‚îÄ‚îÄ VP Engineering
                    ‚îÇ   ‚îú‚îÄ‚îÄ Director Engineering
                    ‚îÇ   ‚îú‚îÄ‚îÄ Director Infrastructure
                    ‚îÇ   ‚îî‚îÄ‚îÄ QA Lead
                    ‚îú‚îÄ‚îÄ VP Sales & Marketing
                    ‚îÇ   ‚îú‚îÄ‚îÄ Sales Manager
                    ‚îÇ   ‚îú‚îÄ‚îÄ Account Manager
                    ‚îÇ   ‚îî‚îÄ‚îÄ Marketing Lead
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ Controller
                        ‚îî‚îÄ‚îÄ Accounting Manager
                `,
                'Financial Services': `
                    CEO/President
                    ‚îú‚îÄ‚îÄ Chief Trading Officer
                    ‚îÇ   ‚îú‚îÄ‚îÄ VP Trading
                    ‚îÇ   ‚îú‚îÄ‚îÄ VP Operations
                    ‚îÇ   ‚îî‚îÄ‚îÄ Risk Manager
                    ‚îú‚îÄ‚îÄ Chief Risk Officer
                    ‚îÇ   ‚îú‚îÄ‚îÄ Compliance Director
                    ‚îÇ   ‚îî‚îÄ‚îÄ Risk Director
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ VP Accounting
                        ‚îî‚îÄ‚îÄ Accounting Manager
                `,
                'Real Estate': `
                    CEO/Broker
                    ‚îú‚îÄ‚îÄ VP Operations
                    ‚îÇ   ‚îú‚îÄ‚îÄ MLS Director
                    ‚îÇ   ‚îú‚îÄ‚îÄ Data Systems Director
                    ‚îÇ   ‚îî‚îÄ‚îÄ Fair Housing Compliance
                    ‚îú‚îÄ‚îÄ VP Sales
                    ‚îÇ   ‚îú‚îÄ‚îÄ Broker Director (x2)
                    ‚îÇ   ‚îî‚îÄ‚îÄ Agent Leads
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ Controller
                        ‚îî‚îÄ‚îÄ Accounting Manager
                `,
                'Healthcare': `
                    CEO/Administrator
                    ‚îú‚îÄ‚îÄ Chief Medical Officer
                    ‚îÇ   ‚îú‚îÄ‚îÄ Clinical Director
                    ‚îÇ   ‚îú‚îÄ‚îÄ Nursing Director
                    ‚îÇ   ‚îî‚îÄ‚îÄ Quality Manager
                    ‚îú‚îÄ‚îÄ VP Operations
                    ‚îÇ   ‚îú‚îÄ‚îÄ Compliance Officer
                    ‚îÇ   ‚îî‚îÄ‚îÄ HR Director
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ Controller
                        ‚îî‚îÄ‚îÄ Billing Manager
                `,
                'Logistics': `
                    CEO/President
                    ‚îú‚îÄ‚îÄ VP Operations
                    ‚îÇ   ‚îú‚îÄ‚îÄ Fleet Director
                    ‚îÇ   ‚îú‚îÄ‚îÄ Dispatch Manager
                    ‚îÇ   ‚îî‚îÄ‚îÄ Maintenance Manager
                    ‚îú‚îÄ‚îÄ VP Sales
                    ‚îÇ   ‚îú‚îÄ‚îÄ Sales Manager (x2)
                    ‚îÇ   ‚îî‚îÄ‚îÄ Customer Service
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ Controller
                        ‚îî‚îÄ‚îÄ Accounting Manager
                `,
                'Professional Services': `
                    Managing Partner
                    ‚îú‚îÄ‚îÄ VP Service Delivery
                    ‚îÇ   ‚îú‚îÄ‚îÄ Service Director (x2)
                    ‚îÇ   ‚îî‚îÄ‚îÄ QA/Training Manager
                    ‚îú‚îÄ‚îÄ VP Business Development
                    ‚îÇ   ‚îú‚îÄ‚îÄ Business Dev Manager (x2)
                    ‚îÇ   ‚îî‚îÄ‚îÄ Marketing Manager
                    ‚îî‚îÄ‚îÄ CFO
                        ‚îú‚îÄ‚îÄ Controller
                        ‚îî‚îÄ‚îÄ Accounting Manager
                `
            };

            const chartPreview = document.getElementById('orgChartPreview');
            chartPreview.textContent = templates[industry] || 'Template not found';

            const recommendations = document.getElementById('hiringRecommendations');
            recommendations.innerHTML = `
                <div class="card">
                    <h3>üìç Phase 1: Executive Layer (Q1)</h3>
                    <p><strong>4-5 positions:</strong> CEO, VP Ops, VP Sales, CFO (+1 depending on industry)</p>
                </div>
                <div class="card">
                    <h3>üìç Phase 2: Management Layer (Q2-Q3)</h3>
                    <p><strong>6-8 positions:</strong> Department managers, team leads, specialists</p>
                </div>
                <div class="card">
                    <h3>üìç Phase 3: Individual Contributors (Q4)</h3>
                    <p><strong>12-15 positions:</strong> Engineers, sales reps, specialists, support staff</p>
                </div>
                <div class="card">
                    <h3>üìç Phase 4: Specialization (Ongoing)</h3>
                    <p><strong>20+ positions:</strong> Advanced roles, directors, department leaders</p>
                </div>
            `;

            document.getElementById('orgChartContainer').style.display = 'block';
        }

        function saveOrgChart() {
            const companyId = localStorage.getItem('companyId');
            const industry = document.getElementById('templateIndustry').value;
            const headcount = document.getElementById('targetHeadcount').value;

            if (!companyId) {
                showError('Please save company information first');
                return;
            }

            // API call would go here
            showSuccess(`Organizational chart saved for ${industry} with ${headcount} target headcount!`);
        }

        function exportOrgChart() {
            showSuccess('Org chart export started...');
            // Export logic would go here
        }

        // ============================================================================
        // COMPLIANCE
        // ============================================================================

        function verifyCompliance() {
            const companyId = localStorage.getItem('companyId');
            if (!companyId) {
                showError('Please save company information first');
                return;
            }

            showSuccess('Compliance verification completed!');
        }

        function generateComplianceReport() {
            showSuccess('Compliance report generated and downloaded!');
        }

        // ============================================================================
        // AUDIT LOG
        // ============================================================================

        function loadAuditLog() {
            const companyId = localStorage.getItem('companyId');
            if (!companyId) {
                showError('Please save company information first');
                return;
            }

            const container = document.getElementById('auditLogContainer');
            container.innerHTML = `
                <div class="audit-entry">
                    <div class="timestamp">2026-01-20 14:23:45</div>
                    <div class="action">CREATE_COMPANY_CONFIG</div>
                    <div>Company configuration created with EIN validation</div>
                </div>
                <div class="audit-entry">
                    <div class="timestamp">2026-01-20 14:25:12</div>
                    <div class="action">UPDATE_COMPANY_CONFIG</div>
                    <div>Banking information encrypted and stored (8 sensitive fields)</div>
                </div>
                <div class="audit-entry">
                    <div class="timestamp">2026-01-20 14:26:33</div>
                    <div class="action">UPDATE_ORG_CHART</div>
                    <div>Organizational chart set to Technology template (150 headcount target)</div>
                </div>
            `;
        }

        function downloadAuditLog() {
            showSuccess('Audit log downloaded as CSV!');
        }

        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================

        function showSuccess(message) {
            const element = document.getElementById('successMessage');
            element.textContent = '‚úì ' + message;
            element.classList.add('show');
            setTimeout(() => element.classList.remove('show'), 5000);
        }

        function showError(message) {
            const element = document.getElementById('errorMessage');
            element.textContent = '‚úó ' + message;
            element.classList.add('show');
            setTimeout(() => element.classList.remove('show'), 5000);
        }

        function resetForm(formId) {
            document.getElementById(formId).reset();
        }

        // Load company data on page load
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            if (!token) {
                showError('Authentication required. Please log in.');
            }
        });
    </script>
</body>
</html>
